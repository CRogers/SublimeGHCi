machine:
  services:
    - docker

dependencies:
  cache_directories:
    - "~/docker"

  override:
    - mkdir -p ~/docker
    - cd ~/docker
    - echo FROM crogers/sublimeghci-docker:latest >Dockerfile
    - ls
    - if [[ -e image.tar ]]; then docker load -i image.tar; fi
    - docker build -t crogers/sublimeghci-docker:latest .
    - docker save crogers/sublimeghci-docker:latest >image.tar
    - cd -

test:
  override:
    - docker run -v "$(pwd):/SublimeGHCi" -e "SLEEP_TIME=5" -v "$CIRCLE_ARTIFACTS:/Logs" crogers/sublimeghci-docker:latest ./run.sh