machine:
  services:
    - docker

dependencies:
  cache_directories:
    - "~/docker"

  override:
    - mkdir -p ~/docker
    - echo FROM crogers/sublimeghci-docker:latest >~/docker/Dockerfile
    - if [[ -e ~/docker/image.tar ]]; then docker load -i ~/docker/image.tar; fi
    - docker build -t crogers/sublimeghci-docker:latest .
    - docker save crogers/sublimeghci-docker:latest >~/docker/image.tar

test:
  override:
    - docker run -v "$(pwd):/SublimeGHCi" -e "SLEEP_TIME=5" -v "$CIRCLE_ARTIFACTS:/Logs" crogers/sublimeghci-docker:latest ./run.sh